# B+ 树

## 背景：B 树的发展

- B 树于 1970 年被引入，不到 10 年就成为主流索引结构
- 目前仍是关系数据库的标准索引实现，许多非关系数据库也在使用
- 与 SSTables 类似，B 树保持键值对按键排序，支持高效的键值查找和范围查询

## B 树的基本特征

### 存储结构

- 数据库被分解为固定大小的块或页面（通常为 4KB）
- 每次只能读写一个页面
- 设计更贴近底层硬件的块状存储结构

### 工作原理

1. 每个页面都有唯一的地址或位置标识
2. 页面之间可以通过引用（类似指针）相互关联
3. 所有页面构成一个树状结构
4. 查找过程：
   - 从根页面开始
   - 根据键值范围选择子页面
   - 递归查找直到找到目标键值

![使用 B 树索引查找一个键](https://assets.ng-tech.icu/item/1y1Y1U.md.png)

## B+ 树特性

B+ 树是 B 树的一个重要变种，在数据库领域（如 MySQL）被广泛使用。

### 与 B 树的主要区别

1. 节点指针限制

   - B+ 树：每个节点的指针上限为 2d
   - B 树：每个节点的指针上限为 2d+1

2. 数据存储方式
   - 内节点：只存储 key，不存储数据
   - 叶子节点：存储数据，不存储指针

下图是一个简单的 B+Tree 示意：

![B+Tree 结构示意图](https://assets.ng-tech.icu/item/007rAy9hly1g162uiayzzj30cq037jrf.jpg)

### B+ 树的优势

- 更适合实现外存储索引结构
- 节点结构更灵活（叶节点和内节点可以有不同大小）

## B+ 树与 B 树的节点空间对比

- B+ 树：叶节点和内节点通常大小不同
- B 树：虽然节点中的 key 和指针数量可能不同，但通常为所有节点分配相同大小的空间
